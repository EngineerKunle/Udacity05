function mapError(e){alert("Google map failed to load")}function initMap(){var e=document.getElementById("map"),n={lat:51.4589,lng:.1384};map=new google.maps.Map(e,{center:n,zoom:14})}function placedMarker(e,n,a,o){var r=this;r.place=e,r.lat=n,r.lng=a,r.description=o;var t=new google.maps.Marker({position:{lat:r.lat,lng:r.lng},title:name,map:map,animation:google.maps.Animation.DROP});return r.infoWindow=new google.maps.InfoWindow({content:r.description}),foursquare(r,function(e,n){e?alert("foursquare failed"):(r.postCode=n.response.venues[0].location.postalCode,r.infoWindow.setContent(r.description+'<br"><p style="text-align:center"> Foursquare says this is the postcode '+r.postCode+" </p>"))}),t.addListener("click",function(){r.infoWindow.open(map,t),t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},2e3)}),t}function initApp(){newModel=new MapViewModel,ko.applyBindings(newModel)}var map,locations=[{name:"Asda",lat:51.45889,lng:.13946,description:"Asda - Place to shop"},{name:"National Trust: The Red House",lat:51.45556,lng:.12954,description:"The Red House - The Red House"},{name:"Broadway Shopping Centre",lat:51.45612,lng:.14616,description:"Broadway Shopping Centre - Bexley Shopping mall"},{name:"Danson Park",lat:51.45577,lng:.12258,description:"Danson Park - Have fun in the park"},{name:"Bexley Train Station",lat:51.46346,lng:.13381,description:"Bexley Train Station - Off to a new city"}],foursquare=function(e,n){var a="O2MRPCSYIDAFMNVONXF5YSNVB3N3FYCY4DISAIQHA4BKLTAO",o="XBRXY4EZI1CPPX5ZG3OS3FHQWJQBYWIHKCIMIKPIOVMKX4RM",r="https://api.foursquare.com/v2/venues/search?ll=51.45889,0.13946&query="+e.place+"&client_id="+a+"&client_secret="+o+"&v=20160309";$.ajax({url:r,dataType:"json",data:"",success:function(e){n(null,e)},error:function(e){n(e),alert("failed to load foursquare")}})},MapViewModel=function(){initMap();var e=this;e.markers=[],e.locationsArray=ko.observableArray(locations),e.clearMarkers=function(){for(var n=0;n<e.markers.length;n++)e.markers[n].setMap(null);e.markers=[]},e.syncMarkers=function(n){var a=n||e.locationsArray();a.forEach(function(n){var a=new placedMarker(n.name,n.lat,n.lng,n.description);e.markers.push(a),console.log(a)})},e.search=ko.observable(""),e.filterPins=ko.computed(function(){if(e.search()){var n=e.search().toLowerCase(),a=ko.utils.arrayFilter(e.locationsArray(),function(e){var a=e.name.toLowerCase();return a.indexOf(n)>-1});return e.clearMarkers(),e.syncMarkers(a),a}return e.locationsArray()}),e.syncMarkers()},newModel;